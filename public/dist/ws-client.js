var runtime=(function(l){"use strict";var m=Object.prototype;var n=m.hasOwnProperty;var o;var p=typeof Symbol==="function"?Symbol:{};var q=p.iterator||"@@iterator";var r=p.asyncIterator||"@@asyncIterator";var s=p.toStringTag||"@@toStringTag";function define(a,b,c){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true});return a[b]}try{define({},"")}catch(err){define=function(a,b,c){return a[b]=c}}function wrap(a,b,c,d){var e=b&&b.prototype instanceof Generator?b:Generator;var f=Object.create(e.prototype);var g=new Context(d||[]);f._invoke=makeInvokeMethod(a,c,g);return f}l.wrap=wrap;function tryCatch(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(err){return{type:"throw",arg:err}}}var t="suspendedStart";var u="suspendedYield";var v="executing";var w="completed";var x={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var y={};y[q]=function(){return this};var z=Object.getPrototypeOf;var A=z&&z(z(values([])));if(A&&A!==m&&n.call(A,q)){y=A}var B=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(y);GeneratorFunction.prototype=B.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction");function defineIteratorMethods(c){["next","throw","return"].forEach(function(b){define(c,b,function(a){return this._invoke(b,a)})})}l.isGeneratorFunction=function(a){var b=typeof a==="function"&&a.constructor;return b?b===GeneratorFunction||(b.displayName||b.name)==="GeneratorFunction":false};l.mark=function(a){if(Object.setPrototypeOf){Object.setPrototypeOf(a,GeneratorFunctionPrototype)}else{a.__proto__=GeneratorFunctionPrototype;define(a,s,"GeneratorFunction")}a.prototype=Object.create(B);return a};l.awrap=function(a){return{__await:a}};function AsyncIterator(i,j){function invoke(b,c,d,e){var f=tryCatch(i[b],i,c);if(f.type==="throw"){e(f.arg)}else{var g=f.arg;var h=g.value;if(h&&typeof h==="object"&&n.call(h,"__await")){return j.resolve(h.__await).then(function(a){invoke("next",a,d,e)},function(a){invoke("throw",a,d,e)})}return j.resolve(h).then(function(a){g.value=a;d(g)},function(a){return invoke("throw",a,d,e)})}}var k;function enqueue(c,d){function callInvokeWithMethodAndArg(){return new j(function(a,b){invoke(c,d,a,b)})}return k=k?k.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[r]=function(){return this};l.AsyncIterator=AsyncIterator;l.async=function(b,c,d,e,f){if(f===void 0)f=Promise;var g=new AsyncIterator(wrap(b,c,d,e),f);return l.isGeneratorFunction(c)?g:g.next().then(function(a){return a.done?a.value:g.next()})};function makeInvokeMethod(f,g,h){var i=t;return function invoke(a,b){if(i===v){throw new Error("Generator is already running");}if(i===w){if(a==="throw"){throw b;}return doneResult()}h.method=a;h.arg=b;while(true){var c=h.delegate;if(c){var d=maybeInvokeDelegate(c,h);if(d){if(d===x)continue;return d}}if(h.method==="next"){h.sent=h._sent=h.arg}else if(h.method==="throw"){if(i===t){i=w;throw h.arg;}h.dispatchException(h.arg)}else if(h.method==="return"){h.abrupt("return",h.arg)}i=v;var e=tryCatch(f,g,h);if(e.type==="normal"){i=h.done?w:u;if(e.arg===x){continue}return{value:e.arg,done:h.done}}else if(e.type==="throw"){i=w;h.method="throw";h.arg=e.arg}}}}function maybeInvokeDelegate(a,b){var c=a.iterator[b.method];if(c===o){b.delegate=null;if(b.method==="throw"){if(a.iterator["return"]){b.method="return";b.arg=o;maybeInvokeDelegate(a,b);if(b.method==="throw"){return x}}b.method="throw";b.arg=new TypeError("The iterator does not provide a 'throw' method")}return x}var d=tryCatch(c,a.iterator,b.arg);if(d.type==="throw"){b.method="throw";b.arg=d.arg;b.delegate=null;return x}var e=d.arg;if(!e){b.method="throw";b.arg=new TypeError("iterator result is not an object");b.delegate=null;return x}if(e.done){b[a.resultName]=e.value;b.next=a.nextLoc;if(b.method!=="return"){b.method="next";b.arg=o}}else{return e}b.delegate=null;return x}defineIteratorMethods(B);define(B,s,"Generator");B[q]=function(){return this};B.toString=function(){return"[object Generator]"};function pushTryEntry(a){var b={tryLoc:a[0]};if(1 in a){b.catchLoc=a[1]}if(2 in a){b.finallyLoc=a[2];b.afterLoc=a[3]}this.tryEntries.push(b)}function resetTryEntry(a){var b=a.completion||{};b.type="normal";delete b.arg;a.completion=b}function Context(a){this.tryEntries=[{tryLoc:"root"}];a.forEach(pushTryEntry,this);this.reset(true)}l.keys=function(b){var c=[];for(var d in b){c.push(d)}c.reverse();return function next(){while(c.length){var a=c.pop();if(a in b){next.value=a;next.done=false;return next}}next.done=true;return next}};function values(a){if(a){var b=a[q];if(b){return b.call(a)}if(typeof a.next==="function"){return a}if(!isNaN(a.length)){var i=-1,next=function next(){while(++i<a.length){if(n.call(a,i)){next.value=a[i];next.done=false;return next}}next.value=o;next.done=true;return next};return next.next=next}}return{next:doneResult}}l.values=values;function doneResult(){return{value:o,done:true}}Context.prototype={constructor:Context,reset:function(a){this.prev=0;this.next=0;this.sent=this._sent=o;this.done=false;this.delegate=null;this.method="next";this.arg=o;this.tryEntries.forEach(resetTryEntry);if(!a){for(var b in this){if(b.charAt(0)==="t"&&n.call(this,b)&&!isNaN(+b.slice(1))){this[b]=o}}}},stop:function(){this.done=true;var a=this.tryEntries[0];var b=a.completion;if(b.type==="throw"){throw b.arg;}return this.rval},dispatchException:function(c){if(this.done){throw c;}var d=this;function handle(a,b){f.type="throw";f.arg=c;d.next=a;if(b){d.method="next";d.arg=o}return!!b}for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];var f=e.completion;if(e.tryLoc==="root"){return handle("end")}if(e.tryLoc<=this.prev){var g=n.call(e,"catchLoc");var h=n.call(e,"finallyLoc");if(g&&h){if(this.prev<e.catchLoc){return handle(e.catchLoc,true)}else if(this.prev<e.finallyLoc){return handle(e.finallyLoc)}}else if(g){if(this.prev<e.catchLoc){return handle(e.catchLoc,true)}}else if(h){if(this.prev<e.finallyLoc){return handle(e.finallyLoc)}}else{throw new Error("try statement without catch or finally");}}}},abrupt:function(a,b){for(var i=this.tryEntries.length-1;i>=0;--i){var c=this.tryEntries[i];if(c.tryLoc<=this.prev&&n.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var d=c;break}}if(d&&(a==="break"||a==="continue")&&d.tryLoc<=b&&b<=d.finallyLoc){d=null}var e=d?d.completion:{};e.type=a;e.arg=b;if(d){this.method="next";this.next=d.finallyLoc;return x}return this.complete(e)},complete:function(a,b){if(a.type==="throw"){throw a.arg;}if(a.type==="break"||a.type==="continue"){this.next=a.arg}else if(a.type==="return"){this.rval=this.arg=a.arg;this.method="return";this.next="end"}else if(a.type==="normal"&&b){this.next=b}return x},finish:function(a){for(var i=this.tryEntries.length-1;i>=0;--i){var b=this.tryEntries[i];if(b.finallyLoc===a){this.complete(b.completion,b.afterLoc);resetTryEntry(b);return x}}},"catch":function(a){for(var i=this.tryEntries.length-1;i>=0;--i){var b=this.tryEntries[i];if(b.tryLoc===a){var c=b.completion;if(c.type==="throw"){var d=c.arg;resetTryEntry(b)}return d;}}throw new Error("illegal catch attempt");},delegateYield:function(a,b,c){this.delegate={iterator:values(a),resultName:b,nextLoc:c};if(this.method==="next"){this.arg=o}return x}};return l}(typeof module==="object"?module.exports:{}));try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}(function(a,b){typeof exports==='object'&&typeof module!=='undefined'?module.exports=b():typeof define==='function'&&define.amd?define(b):(a.adonis=a.adonis||{},a.adonis.Ws=b())}(this,(function(){'use strict';var p=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var q=function(i){return function(){var h=i.apply(this,arguments);return new Promise(function(f,g){function step(b,c){try{var d=h[b](c);var e=d.value}catch(error){g(error);return}if(d.done){f(e)}else{return Promise.resolve(e).then(function(a){step("next",a)},function(a){step("throw",a)})}}return step("next")})}};var u=function(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function");}};var w=function(){function defineProperties(a,b){for(var i=0;i<b.length;i++){var c=b[i];c.enumerable=c.enumerable||false;c.configurable=true;if("value"in c)c.writable=true;Object.defineProperty(a,c.key,c)}}return function(a,b,c){if(b)defineProperties(a.prototype,b);if(c)defineProperties(a,c);return a}}();var z=Object.assign||function(a){for(var i=1;i<arguments.length;i++){var b=arguments[i];for(var c in b){if(Object.prototype.hasOwnProperty.call(b,c)){a[c]=b[c]}}}return a};var A=function(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b);}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b};var B=function(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return b&&(typeof b==="object"||typeof b==="function")?b:a};var C=function(a){if(Array.isArray(a)){for(var i=0,arr2=Array(a.length);i<a.length;i++)arr2[i]=a[i];return arr2}else{return Array.from(a)}};var D=new WeakMap();var E=new WeakMap();var F=Promise.resolve();function assertEventName(a){if(typeof a!=='string'){throw new TypeError('eventName must be a string');}}function assertListener(a){if(typeof a!=='function'){throw new TypeError('listener must be a function');}}function getListeners(a,b){var c=E.get(a);if(!c.has(b)){c.set(b,new Set())}return c.get(b)}var G=function(){function G(){u(this,G);D.set(this,new Set());E.set(this,new Map())}w(G,[{key:'on',value:function on(a,b){assertEventName(a);assertListener(b);getListeners(this,a).add(b);return this.off.bind(this,a,b)}},{key:'off',value:function off(a,b){assertEventName(a);assertListener(b);getListeners(this,a).delete(b)}},{key:'once',value:function once(d){var e=this;return new Promise(function(b){assertEventName(d);var c=e.on(d,function(a){c();b(a)})})}},{key:'emit',value:function(){var i=q(regeneratorRuntime.mark(function _callee3(e,f){var g=this;var h,anyListeners,staticListeners,staticAnyListeners;return regeneratorRuntime.wrap(function _callee3$(d){while(1){switch(d.prev=d.next){case 0:assertEventName(e);h=getListeners(this,e);anyListeners=D.get(this);staticListeners=[].concat(C(h));staticAnyListeners=[].concat(C(anyListeners));d.next=7;return F;case 7:return d.abrupt('return',Promise.all([].concat(C(staticListeners.map(function(){var c=q(regeneratorRuntime.mark(function _callee(b){return regeneratorRuntime.wrap(function _callee$(a){while(1){switch(a.prev=a.next){case 0:if(!h.has(b)){a.next=2;break}return a.abrupt('return',b(f));case 2:case'end':return a.stop()}}},_callee,g)}));return function(a){return c.apply(this,arguments)}}())),C(staticAnyListeners.map(function(){var c=q(regeneratorRuntime.mark(function _callee2(b){return regeneratorRuntime.wrap(function _callee2$(a){while(1){switch(a.prev=a.next){case 0:if(!anyListeners.has(b)){a.next=2;break}return a.abrupt('return',b(e,f));case 2:case'end':return a.stop()}}},_callee2,g)}));return function(a){return c.apply(this,arguments)}}())))));case 8:case'end':return d.stop()}}},_callee3,this)}));function emit(a,b){return i.apply(this,arguments)}return emit}()},{key:'emitSerial',value:function(){var e=q(regeneratorRuntime.mark(function _callee4(b,c){var d,anyListeners,staticListeners,staticAnyListeners,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,listener,_iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,_listener;return regeneratorRuntime.wrap(function _callee4$(a){while(1){switch(a.prev=a.next){case 0:assertEventName(b);d=getListeners(this,b);anyListeners=D.get(this);staticListeners=[].concat(C(d));staticAnyListeners=[].concat(C(anyListeners));a.next=7;return F;case 7:_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;a.prev=10;_iterator=staticListeners[Symbol.iterator]();case 12:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){a.next=20;break}listener=_step.value;if(!d.has(listener)){a.next=17;break}a.next=17;return listener(c);case 17:_iteratorNormalCompletion=true;a.next=12;break;case 20:a.next=26;break;case 22:a.prev=22;a.t0=a['catch'](10);_didIteratorError=true;_iteratorError=a.t0;case 26:a.prev=26;a.prev=27;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 29:a.prev=29;if(!_didIteratorError){a.next=32;break}throw _iteratorError;case 32:return a.finish(29);case 33:return a.finish(26);case 34:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;a.prev=37;_iterator2=staticAnyListeners[Symbol.iterator]();case 39:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){a.next=47;break}_listener=_step2.value;if(!anyListeners.has(_listener)){a.next=44;break}a.next=44;return _listener(b,c);case 44:_iteratorNormalCompletion2=true;a.next=39;break;case 47:a.next=53;break;case 49:a.prev=49;a.t1=a['catch'](37);_didIteratorError2=true;_iteratorError2=a.t1;case 53:a.prev=53;a.prev=54;if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}case 56:a.prev=56;if(!_didIteratorError2){a.next=59;break}throw _iteratorError2;case 59:return a.finish(56);case 60:return a.finish(53);case 61:case'end':return a.stop()}}},_callee4,this,[[10,22,26,34],[27,,29,33],[37,49,53,61],[54,,56,60]])}));function emitSerial(a,b){return e.apply(this,arguments)}return emitSerial}()},{key:'onAny',value:function onAny(a){assertListener(a);D.get(this).add(a);return this.offAny.bind(this,a)}},{key:'offAny',value:function offAny(a){assertListener(a);D.get(this).delete(a)}},{key:'clearListeners',value:function clearListeners(a){if(typeof a==='string'){getListeners(this,a).clear()}else{D.get(this).clear();var b=true;var c=false;var d=undefined;try{for(var e=E.get(this).values()[Symbol.iterator](),_step3;!(b=(_step3=e.next()).done);b=true){var f=_step3.value;f.clear()}}catch(err){c=true;d=err}finally{try{if(!b&&e.return){e.return()}}finally{if(c){throw d;}}}}}},{key:'listenerCount',value:function listenerCount(a){if(typeof a==='string'){return D.get(this).size+getListeners(this,a).size}if(typeof a!=='undefined'){assertEventName(a)}var b=D.get(this).size;var c=true;var d=false;var e=undefined;try{for(var f=E.get(this).values()[Symbol.iterator](),_step4;!(c=(_step4=f.next()).done);c=true){var g=_step4.value;b+=g.size}}catch(err){d=true;e=err}finally{try{if(!c&&f.return){f.return()}}finally{if(d){throw e;}}}return b}}]);return G}();G.Typed=function(a){A(_class,a);function _class(){u(this,_class);return B(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}return _class}(G);Object.defineProperty(G.Typed,'Typed',{enumerable:false,value:undefined});var H=G;var I=function I(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(x){return'%'+x.charCodeAt(0).toString(16).toUpperCase()})};function encoderForArrayFormat(d){switch(d.arrayFormat){case'index':return function(a,b,c){return b===null?[encode(a,d),'[',c,']'].join(''):[encode(a,d),'[',encode(c,d),']=',encode(b,d)].join('')};case'bracket':return function(a,b){return b===null?encode(a,d):[encode(a,d),'[]=',encode(b,d)].join('')};default:return function(a,b){return b===null?encode(a,d):[encode(a,d),'=',encode(b,d)].join('')}}}function encode(a,b){if(b.encode){return b.strict?I(a):encodeURIComponent(a)}return a}var J=function J(i,j){var k={encode:true,strict:true,arrayFormat:'none'};j=z(k,j);if(j.sort===false){j.sort=function(){}}var l=encoderForArrayFormat(j);return i?Object.keys(i).sort(j.sort).map(function(a){var b=i[a];if(b===undefined){return''}if(b===null){return encode(a,j)}if(Array.isArray(b)){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=b.slice()[Symbol.iterator](),_step2;!(d=(_step2=g.next()).done);d=true){var h=_step2.value;if(h===undefined){continue}c.push(l(a,h,c.length))}}catch(err){e=true;f=err}finally{try{if(!d&&g.return){g.return()}}finally{if(e){throw f;}}}return c.join('&')}return encode(a,j)+'='+encode(b,j)}).filter(function(x){return x.length>0}).join('&'):''};var K=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function createCommonjsModule(a,b){return b={exports:{}},a(b,b.exports),b.exports}var L=createCommonjsModule(function(a,b){!function(t,e){a.exports=e()}(K,function(){var t="function"==typeof Symbol&&"symbol"==p(Symbol.iterator)?function(t){return typeof t==='undefined'?'undefined':p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t==='undefined'?'undefined':p(t)},e={OPEN:0,JOIN:1,LEAVE:2,JOIN_ACK:3,JOIN_ERROR:4,LEAVE_ACK:5,LEAVE_ERROR:6,EVENT:7,PING:8,PONG:9};function o(t,e,o){return o.forEach(function(t){!function(t,e){if(!t||"string"!=typeof t)throw new Error(e);}(e[t],"expected "+t+" to be a valid string")}),{t:t,d:e}}var n={};return Object.keys(e).forEach(function(o){var i=o.toLowerCase().replace(/^\w|_(\w)/g,function(t,e){return e?e.toUpperCase():t.toUpperCase()});n["is"+i+"Packet"]=function(n){return!(!n||"object"!==(void 0===n?"undefined":t(n))||n.t!==e[o])}}),n.hasTopic=function(t){return!!(t&&t.d&&t.d.topic)},n.isValidJoinPacket=n.hasTopic,n.isValidLeavePacket=n.hasTopic,n.isValidEventPacket=n.hasTopic,n.joinPacket=function(t){return o(e.JOIN,{topic:t},["topic"])},n.leavePacket=function(t){return o(e.LEAVE,{topic:t},["topic"])},n.joinAckPacket=function(t){return o(e.JOIN_ACK,{topic:t},["topic"])},n.joinErrorPacket=function(t,n){return o(e.JOIN_ERROR,{topic:t,message:n},["topic","message"])},n.leaveAckPacket=function(t){return o(e.LEAVE_ACK,{topic:t},["topic"])},n.leaveErrorPacket=function(t,n){return o(e.LEAVE_ERROR,{topic:t,message:n},["topic","message"])},n.eventPacket=function(t,n,i){return o(e.EVENT,{topic:t,event:n,data:i=i||""},["topic","event"])},n.pingPacket=function(){return{t:e.PING}},n.pongPacket=function(){return{t:e.PONG}},z({codes:e},n)})});var s=1000;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;var M=function M(a,b){b=b||{};var c=typeof a==='undefined'?'undefined':p(a);if(c==='string'&&a.length>0){return parse$1(a)}else if(c==='number'&&isNaN(a)===false){return b.long?fmtLong(a):fmtShort(a)}throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(a));};function parse$1(a){a=String(a);if(a.length>100){return}var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(!b){return}var n=parseFloat(b[1]);var c=(b[2]||'ms').toLowerCase();switch(c){case'years':case'year':case'yrs':case'yr':case'y':return n*y;case'days':case'day':case'd':return n*d;case'hours':case'hour':case'hrs':case'hr':case'h':return n*h;case'minutes':case'minute':case'mins':case'min':case'm':return n*m;case'seconds':case'second':case'secs':case'sec':case's':return n*s;case'milliseconds':case'millisecond':case'msecs':case'msec':case'ms':return n;default:return undefined}}function fmtShort(a){if(a>=d){return Math.round(a/d)+'d'}if(a>=h){return Math.round(a/h)+'h'}if(a>=m){return Math.round(a/m)+'m'}if(a>=s){return Math.round(a/s)+'s'}return a+'ms'}function fmtLong(a){return plural(a,d,'day')||plural(a,h,'hour')||plural(a,m,'minute')||plural(a,s,'second')||a+' ms'}function plural(a,n,b){if(a<n){return}if(a<n*1.5){return Math.floor(a/n)+' '+b}return Math.ceil(a/n)+' '+b+'s'}var N=createCommonjsModule(function(m,n){n=m.exports=createDebug.debug=createDebug['default']=createDebug;n.coerce=coerce;n.disable=disable;n.enable=enable;n.enabled=enabled;n.humanize=M;n.names=[];n.skips=[];n.formatters={};var o;function selectColor(a){var b=0,i;for(i in a){b=(b<<5)-b+a.charCodeAt(i);b|=0}return n.colors[Math.abs(b)%n.colors.length]}function createDebug(l){function N(){if(!N.enabled)return;var e=N;var f=+new Date();var g=f-(o||f);e.diff=g;e.prev=o;e.curr=f;o=f;var h=new Array(arguments.length);for(var i=0;i<h.length;i++){h[i]=arguments[i]}h[0]=n.coerce(h[0]);if('string'!==typeof h[0]){h.unshift('%O')}var j=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(a,b){if(a==='%%')return a;j++;var c=n.formatters[b];if('function'===typeof c){var d=h[j];a=c.call(e,d);h.splice(j,1);j--}return a});n.formatArgs.call(e,h);var k=N.log||n.log||console.log.bind(console);k.apply(e,h)}N.namespace=l;N.enabled=n.enabled(l);N.useColors=n.useColors();N.color=selectColor(l);if('function'===typeof n.init){n.init(N)}return N}function enable(a){n.save(a);n.names=[];n.skips=[];var b=(typeof a==='string'?a:'').split(/[\s,]+/);var c=b.length;for(var i=0;i<c;i++){if(!b[i])continue;a=b[i].replace(/\*/g,'.*?');if(a[0]==='-'){n.skips.push(new RegExp('^'+a.substr(1)+'$'))}else{n.names.push(new RegExp('^'+a+'$'))}}}function disable(){n.enable('')}function enabled(a){var i,len;for(i=0,len=n.skips.length;i<len;i++){if(n.skips[i].test(a)){return false}}for(i=0,len=n.names.length;i<len;i++){if(n.names[i].test(a)){return true}}return false}function coerce(a){if(a instanceof Error)return a.stack||a.message;return a}});var O=N.coerce;var P=N.disable;var Q=N.enable;var R=N.enabled;var S=N.humanize;var T=N.names;var U=N.skips;var V=N.formatters;var W=createCommonjsModule(function(g,h){h=g.exports=N;h.log=log;h.formatArgs=formatArgs;h.save=save;h.load=load;h.useColors=useColors;h.storage='undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage?chrome.storage.local:localstorage();h.colors=['lightseagreen','forestgreen','goldenrod','dodgerblue','darkorchid','crimson'];function useColors(){if(typeof window!=='undefined'&&window.process&&window.process.type==='renderer'){return true}return typeof document!=='undefined'&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=='undefined'&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}h.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return'[UnexpectedJSONParseError]: '+err.message}};function formatArgs(b){var d=this.useColors;b[0]=(d?'%c':'')+this.namespace+(d?' %c':' ')+b[0]+(d?'%c ':' ')+'+'+h.humanize(this.diff);if(!d)return;var c='color: '+this.color;b.splice(1,0,c,'color: inherit');var e=0;var f=0;b[0].replace(/%[a-zA-Z%]/g,function(a){if('%%'===a)return;e++;if('%c'===a){f=e}});b.splice(f,0,c)}function log(){return'object'===(typeof console==='undefined'?'undefined':p(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(a){try{if(null==a){h.storage.removeItem('debug')}else{h.storage.debug=a}}catch(e){}}function load(){var r;try{r=h.storage.debug}catch(e){}if(!r&&typeof process!=='undefined'&&'env'in process){r=process.env.DEBUG}return r}h.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}});var X=W.log;var Y=W.formatArgs;var Z=W.save;var ba=W.load;var bb=W.useColors;var bc=W.storage;var bd=W.colors;var be=createCommonjsModule(function(a){{var b=W;b.enable('adonis:*');a.exports=b('adonis:websocket')}});var bf=function(){function bf(a,b){u(this,bf);this.topic=a;this.connection=b;this.emitter=new H();this._state='pending';this._emitBuffer=[]}w(bf,[{key:'joinAck',value:function joinAck(){var b=this;this.state='open';this.emitter.emit('ready',this);{be('clearing emit buffer for %s topic after subscription ack',this.topic)}this._emitBuffer.forEach(function(a){return b.emit(a.event,a.data)});this._emitBuffer=[]}},{key:'joinError',value:function joinError(a){this.state='error';this.emitter.emit('error',a);this.serverClose()}},{key:'leaveAck',value:function leaveAck(){this.state='closed';this.serverClose()}},{key:'leaveError',value:function leaveError(a){this.emitter.emit('leaveError',a)}},{key:'on',value:function on(){var a;(a=this.emitter).on.apply(a,arguments)}},{key:'once',value:function once(){var a;(a=this.emitter).once.apply(a,arguments)}},{key:'off',value:function off(){var a;(a=this.emitter).off.apply(a,arguments)}},{key:'emit',value:function emit(a,b){if(this.state==='pending'){this._emitBuffer.push({event:a,data:b});return}this.connection.sendEvent(this.topic,a,b)}},{key:'serverClose',value:function serverClose(){var a=this;return this.emitter.emit('close',this).then(function(){a._emitBuffer=[];a.emitter.clearListeners()}).catch(function(){a._emitBuffer=[];a.emitter.clearListeners()})}},{key:'serverEvent',value:function serverEvent(a){var b=a.event,data=a.data;this.emitter.emit(b,data)}},{key:'serverError',value:function serverError(){this.state='error'}},{key:'close',value:function close(){this.state='closing';{be('closing subscription for %s topic with server',this.topic)}this.connection.sendPacket(L.leavePacket(this.topic))}},{key:'terminate',value:function terminate(){this.leaveAck()}},{key:'state',get:function get$$1(){return this._state},set:function set$$1(a){if(!this.constructor.states.indexOf(a)===-1){throw new Error(a+' is not a valid socket state');}this._state=a}}],[{key:'states',get:function get$$1(){return['pending','open','closed','closing','error']}}]);return bf}();var bg={name:'json',encode:function encode(a,b){var c=null;try{c=JSON.stringify(a)}catch(error){return b(error)}b(null,c)},decode:function decode(a,b){var c=null;try{c=JSON.parse(a)}catch(error){return b(error)}b(null,c)}};var bh=window.location.protocol==='https:'?'wss':'ws';var bi=function(f){A(bi,f);function bi(c,d){u(this,bi);var e=B(this,(bi.__proto__||Object.getPrototypeOf(bi)).call(this));c=c||bh+'://'+window.location.host;e.options=z({path:'adonis-ws',reconnection:true,reconnectionAttempts:10,reconnectionDelay:1000,query:null,encoder:bg},d);{be('connection options %o',e.options)}e._connectionState='idle';e._reconnectionAttempts=0;e._packetsQueue=[];e._processingQueue=false;e._pingTimer=null;e._extendedQuery={};e._url=c.replace(/\/$/,'')+'/'+e.options.path;e.subscriptions={};e.removeSubscription=function(a){var b=a.topic;delete e.subscriptions[b]};return e}w(bi,[{key:'_cleanup',value:function _cleanup(){clearInterval(this._pingTimer);this.ws=null;this._pingTimer=null}},{key:'_subscriptionsIterator',value:function _subscriptionsIterator(b){var c=this;Object.keys(this.subscriptions).forEach(function(a){return b(c.subscriptions[a],a)})}},{key:'_ensureSubscription',value:function _ensureSubscription(a,b){var c=this.getSubscription(a.d.topic);if(!c){{be('cannot consume packet since %s topic has no active subscription %j',a.d.topic,a)}return}b(c,a)}},{key:'_processQueue',value:function _processQueue(){var c=this;if(this._processingQueue||!this._packetsQueue.length){return}this._processingQueue=true;this.options.encoder.encode(this._packetsQueue.shift(),function(a,b){if(a){{be('encode error %j',a)}return}c.write(b);c._processingQueue=false;c._processQueue()})}},{key:'_onOpen',value:function _onOpen(){{be('opened')}}},{key:'_onError',value:function _onError(b){{be('error %O',b)}this._subscriptionsIterator(function(a){return a.serverError()});this.emit('error',b)}},{key:'_reconnect',value:function _reconnect(){var a=this;this._reconnectionAttempts++;this.emit('reconnect',this._reconnectionAttempts);setTimeout(function(){a._connectionState='reconnect';a.connect()},this.options.reconnectionDelay*this._reconnectionAttempts)}},{key:'_onClose',value:function _onClose(b){var c=this;{be('closing from %s state',this._connectionState)}this._cleanup();this._subscriptionsIterator(function(a){return a.terminate()});this.emit('close',this).then(function(){c.shouldReconnect?c._reconnect():c.clearListeners()}).catch(function(){c.shouldReconnect?c._reconnect():c.clearListeners()})}},{key:'_onMessage',value:function _onMessage(c){var d=this;this.options.encoder.decode(c.data,function(a,b){if(a){{be('packet dropped, decode error %o',a)}return}d._handleMessage(b)})}},{key:'_handleMessage',value:function _handleMessage(a){if(L.isOpenPacket(a)){{be('open packet')}this._handleOpen(a);return}if(L.isJoinAckPacket(a)){{be('join ack packet')}this._handleJoinAck(a);return}if(L.isJoinErrorPacket(a)){{be('join error packet')}this._handleJoinError(a);return}if(L.isLeaveAckPacket(a)){{be('leave ack packet')}this._handleLeaveAck(a);return}if(L.isLeaveErrorPacket(a)){{be('leave error packet')}this._handleLeaveError(a);return}if(L.isLeavePacket(a)){{be('leave packet')}this._handleServerLeave(a);return}if(L.isEventPacket(a)){{be('event packet')}this._handleEvent(a);return}if(L.isPongPacket(a)){{be('pong packet')}return}{be('invalid packet type %d',a.t)}}},{key:'_handleOpen',value:function _handleOpen(b){var c=this;this._connectionState='open';this.emit('open',b.d);this._pingTimer=setInterval(function(){c.sendPacket(L.pingPacket())},b.d.clientInterval);{be('processing pre connection subscriptions %o',Object.keys(this.subscriptions))}this._subscriptionsIterator(function(a){c._sendSubscriptionPacket(a.topic)})}},{key:'_handleJoinAck',value:function _handleJoinAck(b){this._ensureSubscription(b,function(a){return a.joinAck()})}},{key:'_handleJoinError',value:function _handleJoinError(c){this._ensureSubscription(c,function(a,b){return a.joinError(b.d)})}},{key:'_handleLeaveAck',value:function _handleLeaveAck(b){this._ensureSubscription(b,function(a){return a.leaveAck()})}},{key:'_handleLeaveError',value:function _handleLeaveError(c){this._ensureSubscription(c,function(a,b){return a.leaveError(b.d)})}},{key:'_handleServerLeave',value:function _handleServerLeave(c){this._ensureSubscription(c,function(a,b){return a.leaveAck()})}},{key:'_handleEvent',value:function _handleEvent(c){this._ensureSubscription(c,function(a,b){return a.serverEvent(b.d)})}},{key:'_sendSubscriptionPacket',value:function _sendSubscriptionPacket(a){{be('initiating subscription for %s topic with server',a)}this.sendPacket(L.joinPacket(a))}},{key:'connect',value:function connect(){var b=this;var c=J(z({},this.options.query,this._extendedQuery));var d=c?this._url+'?'+c:this._url;{be('creating socket connection on %s url',d)}this.ws=new window.WebSocket(d);this.ws.onclose=function(a){return b._onClose(a)};this.ws.onerror=function(a){return b._onError(a)};this.ws.onopen=function(a){return b._onOpen(a)};this.ws.onmessage=function(a){return b._onMessage(a)};return this}},{key:'write',value:function write(a){if(this.ws.readyState!==window.WebSocket.OPEN){{be('connection is not in open state, current state %s',this.ws.readyState)}return}this.ws.send(a)}},{key:'sendPacket',value:function sendPacket(a){this._packetsQueue.push(a);this._processQueue()}},{key:'getSubscription',value:function getSubscription(a){return this.subscriptions[a]}},{key:'hasSubcription',value:function hasSubcription(a){return!!this.getSubscription(a)}},{key:'subscribe',value:function subscribe(a){if(!a||typeof a!=='string'){throw new Error('subscribe method expects topic to be a valid string');}if(this.subscriptions[a]){throw new Error('Cannot subscribe to same topic twice. Instead use getSubscription');}var b=new bf(a,this);b.on('close',this.removeSubscription);this.subscriptions[a]=b;if(this._connectionState==='open'){this._sendSubscriptionPacket(a)}return b}},{key:'sendEvent',value:function sendEvent(a,b,c){if(!a||!b){throw new Error('topic and event name is required to call sendEvent method');}var d=this.getSubscription(a);if(!d){throw new Error('There is no active subscription for '+a+' topic');}if(d.state!=='open'){throw new Error('Cannot emit since subscription socket is in '+this.state+' state');}{be('sending event on %s topic',a)}this.sendPacket(L.eventPacket(a,b,c))}},{key:'withJwtToken',value:function withJwtToken(a){this._extendedQuery.token=a;return this}},{key:'withBasicAuth',value:function withBasicAuth(a,b){this._extendedQuery.basic=window.btoa(a+':'+b);return this}},{key:'withApiToken',value:function withApiToken(a){this._extendedQuery.token=a;return this}},{key:'close',value:function close(){this._connectionState='terminated';this.ws.close()}},{key:'shouldReconnect',get:function get$$1(){return this._connectionState!=='terminated'&&this.options.reconnection&&this.options.reconnectionAttempts>this._reconnectionAttempts}}]);return bi}(H);function index(a,b){return new bi(a,b)}return index})));
